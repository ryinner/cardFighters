var oe=Object.defineProperty;var ce=(a,e,t)=>e in a?oe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var _=(a,e,t)=>(ce(a,typeof e!="symbol"?e+"":e,t),t);import{M as le,D as de,j as ue,k,f as E,l as _e,d as T,i as P,c as h,b as l,m as N,q as X,T as K,o,_ as H,s as R,v as Y,w as y,t as w,r as F,F as A,n as B,g as C,x as J,a as m,y as he,e as $,z as ve,A as fe,B as pe,u as me,C as x,E as W,G as ge}from"./index-36c9ab79.js";import{A as I,c as ye}from"./cards.map-caeb7785.js";import{_ as Ae}from"./BaseLink.vue_vue_type_style_index_0_lang-df93dadc.js";function z(a){a.forEach(e=>{Object.values(e.actions).forEach(t=>{t.actions.forEach(s=>{s.reactivate()})})})}const Pe="/cardFighters/assets/free-icon-heart-8298449-f078d28a.png",ke="/cardFighters/assets/free-icon-sword-65741-2fdbd9df.png";class Q{constructor(e,t){_(this,"name");_(this,"power");_(this,"haveBeenActivated");this.name=e,this.power=t,this.haveBeenActivated=!1}get isActivated(){return this.haveBeenActivated}activate(e){!this.haveBeenActivated&&this.tryAction(e)&&(this.haveBeenActivated=!0)}reactivate(){this.haveBeenActivated=!1}}class Z extends Q{constructor(e){super(I.attack,e)}tryAction(e){return e.isAlive?(e.takeDamage(this.power),!0):!1}}class ee extends Q{constructor(e){super(I.heal,e)}tryAction(e){return e.isAlive?(e.takeHeal(this.power),!0):!1}}function we(a){const e={};let t;if(a.forEach(r=>{const{quantity:i=1,power:n=1,name:c}=r;if(i<=0)throw new Error("Actions quantity can't be less 1");for(let v=0;v<i;v++){let p;switch(c){case I.attack:p=new Z(n),t=ke;break;case I.heal:p=new ee(n),t=Pe;break}let f=e[c];if(f||(e[c]={actions:[],image:t},f=e[c]),f&&(f.actions.push(p),!f.actions.length))throw new Error("Cards actions length is zero or undefined")}}),!s(e))throw new Error("No actions for cards");return e;function s(r){return Object.keys(r).length>0}}var g=(a=>(a.takeDamage="takeDamage",a.heal="heal",a.die="die",a))(g||{});function Te(){const a={};if(Object.values(g).forEach(t=>{a[t]=[]}),e(a))return a;throw new Error("Invalid eventsHandlers");function e(t){return Object.keys(t).length===Object.keys(g).length}}class te{constructor(e){_(this,"name");_(this,"image");_(this,"actions");_(this,"maxHealPoints");_(this,"healPoints");_(this,"eventsHandlers");this.healPoints=e.healthPoints,this.maxHealPoints=e.healthPoints,this.name=e.name,this.image=e.image,this.actions=we(e.actions),this.eventsHandlers=Te()}get hp(){return this.healPoints}set hp(e){e<=0?this.die():(this.healPoints=e>this.maxHealPoints?this.maxHealPoints:e,this.fireEvent(g.heal,e))}get isAlive(){return this.hp>0}takeDamage(e){this.hp-=e,this.fireEvent(g.takeDamage,e)}takeHeal(e){this.isAlive&&(this.hp+=e,this.fireEvent(g.heal,e))}addHandler(e,t){this.eventsHandlers[e].push(t)}clearHandlers(){Object.keys(this.eventsHandlers).forEach(e=>{this.eventsHandlers[e]=[]})}fireEvent(e,t){this.eventsHandlers[e].forEach(s=>{s(t)})}die(){this.healPoints=0,this.fireEvent(g.die)}}class ae extends te{constructor(e){super(e)}}class He extends te{constructor(e){super(e)}}function D(a){switch(a.type){case"warrior":return new He(a);case"healer":return new ae(a)}}function be(a){return a.reduce((e,t)=>{const s=t.actions;return Object.values(s).forEach(r=>{e+=r.actions.filter(i=>!i.isActivated).length}),e},0)}function Ee(){const a=[...ye],e=[];for(let t=0;t<le;t++){const s=Math.floor(Math.random()*a.length),r=a.splice(s,1);e.push(...r)}return e}function Fe(a){return a.reduce((e,t)=>e+=t.power,0)}function j(a){const e=a.length/3,t=Fe(a)/2;return e+t}function Ce(a,e){const t=(e-a)*2,s=e/4;return t+s}function V(a,e){const{attackPower:t,leftHp:s,healPower:r}=e,i=s*Ce(a.hp,a.maxHealPoints),n=t*j(a.actions.attack.actions),c=a instanceof ae?a.actions.heal.actions:[],v=r*j(c);return n+i+v}class $e{constructor(e){_(this,"cardHealPowerPriority");_(this,"cardAttackPowerPriority");_(this,"cardLeftHpPriority");_(this,"botCards");_(this,"playersCards");this.cardHealPowerPriority=e.healPower,this.cardAttackPowerPriority=e.attackPower,this.cardLeftHpPriority=e.leftHp,this.botCards=e.botCards,this.playersCards=e.playerCards}async makeActions(){for(const e of this.botCards)if(e.isAlive){const t=Object.values(e.actions);for(const s of t)for(const r of s.actions)await new Promise(i=>{setTimeout(()=>{this.getTarget(r),i(!0)},de)})}}getTarget(e){let t;e instanceof ee&&(t=this.getHealTarget()),e instanceof Z&&(t=this.getAttackTarget()),e.tryAction(t)}getHealTarget(){const e=[];return this.botCards.forEach(t=>{if(t.isAlive&&t.maxHealPoints!==t.hp){const s=V(t,{healPower:this.cardHealPowerPriority,attackPower:this.cardAttackPowerPriority,leftHp:this.cardLeftHpPriority});e.push({fighter:t,priority:s})}}),e.sort((t,s)=>s.priority-t.priority)[0].fighter}getAttackTarget(){return this.getAlive(this.playersCards).map(s=>{const r=V(s,{healPower:this.cardHealPowerPriority,attackPower:this.cardAttackPowerPriority,leftHp:this.cardLeftHpPriority});return{fighter:s,priority:r}}).sort((s,r)=>r.priority-s.priority)[0].fighter}getAlive(e){return e.filter(t=>t.isAlive)}}function U(a){const e=Math.trunc(a);return e<10?`0${e}`:e.toString()}const O=ue("fight",()=>{const a={number:0,timeLeft:0,minutes:"0",seconds:"0"},e=k({...a});let t;const s=E(()=>e.value.number%2!==0),r=()=>{e.value={...a}},i=()=>{++e.value.number,e.value.timeLeft=_e*60,t&&clearInterval(t),t=setInterval(()=>{e.value.timeLeft<=0?(n(),i()):(e.value.minutes=U(e.value.timeLeft/60),e.value.seconds=U(e.value.timeLeft%60),--e.value.timeLeft)},1e3)},n=()=>{clearInterval(t),e.value.timeLeft=0};return{tour:e,isPlayer:s,setInitialValue:r,startNewTour:i,endTour:n,startGame:()=>{r(),i()},endGame:()=>{clearInterval(t)}}}),Be={key:0,class:"modal"},Ie={class:"modal__content"},Me={class:"modal__header"},xe={class:"modal__body"},Se=T({__name:"BaseModal",props:{isOpen:{type:Boolean}},emits:["open","close"],setup(a,{emit:e}){return(t,s)=>(o(),P(K,{to:"body"},[t.isOpen?(o(),h("div",Be,[l("div",{class:"modal__background",onClick:s[0]||(s[0]=r=>e("close"))}),l("div",Ie,[l("div",Me,[N(t.$slots,"header",{},void 0,!0)]),l("div",xe,[N(t.$slots,"body",{},void 0,!0)])])])):X("",!0)]))}});const se=H(Se,[["__scopeId","data-v-f310c80d"]]),Oe={class:"card-fighter__stats"},Ge={class:"card-fighter__hp",title:"hp"},Le={class:"card-fighter__portrait"},Ne=["src","alt"],We={class:"card-fighter__text"},ze={class:"card-fighter__actions"},De=["src","alt"],je=T({__name:"CardFighter",props:{fighter:{},isPlayer:{type:Boolean},isSelected:{type:Boolean}},setup(a){const e=a,t=k(!1),s=()=>{Object.values(g).forEach(n=>{e.fighter.addHandler(n,()=>{t.value=n,r()})})},r=()=>{setTimeout(()=>{t.value=!1},1e3)},i=()=>{e.fighter.clearHandlers()};return R(s),Y(i),(n,c)=>(o(),P(J,{name:"card-fighter-dying"},{default:y(()=>[l("div",{ref:"cardFighterElement",class:B(["card-fighter",{"card-fighter--player":n.isPlayer,"card-fighter--enemy":!n.isPlayer,"card-fighter--selected":n.isSelected,"card-fighter--damaged":t.value===C(g).takeDamage}])},[l("div",Oe,[l("div",Ge,w(n.fighter.hp),1)]),l("div",Le,[l("img",{src:n.fighter.image,alt:n.fighter.name,class:"card-fighter__image"},null,8,Ne)]),l("div",We,w(n.fighter.name),1),l("div",ze,[(o(!0),h(A,null,F(n.fighter.actions,(v,p)=>(o(),h(A,{key:p},[(o(!0),h(A,null,F(v.actions,f=>(o(),h("img",{key:f.name,src:v.image,alt:f.name,class:B([{"card-fighter__action-icon--activated":f.isActivated},"card-fighter__action-icon"])},null,10,De))),128))],64))),128))])],2)]),_:1}))}});const S=H(je,[["__scopeId","data-v-fe166ac0"]]),Ve={class:"graveyard__fighters"},Ue=T({__name:"BaseGraveyard",props:{isPlayer:{type:Boolean},cardsFighters:{},cardSize:{}},setup(a){const e=a,t=k(!1),s=E(()=>e.isPlayer?"Player":"Enemy"),r=E(()=>e.cardsFighters.filter(i=>!i.isAlive));return(i,n)=>(o(),h("div",{class:"graveyard",style:he(i.cardSize),onClick:n[2]||(n[2]=c=>t.value=!0)},[m(se,{"is-open":t.value,onClose:n[0]||(n[0]=c=>t.value=!1),onOpen:n[1]||(n[1]=c=>t.value=!0)},{header:y(()=>[$(w(s.value)+" graveyard ",1)]),body:y(()=>[l("div",Ve,[(o(!0),h(A,null,F(r.value,c=>(o(),P(S,{key:c.name,class:"graveyard__card",fighter:c,"is-player":i.isPlayer},null,8,["fighter","is-player"]))),128))])]),_:1},8,["is-open"])],4))}});const q=H(Ue,[["__scopeId","data-v-64d699e7"]]),qe={class:"end-game__body"},Xe={class:"end-game__stats"},Ke=T({__name:"EndGameScreen",props:{isWin:{type:Boolean},gameEnd:{type:Boolean}},setup(a){const e=O();return(t,s)=>(o(),P(se,{"is-open":t.gameEnd},{header:y(()=>[t.isWin?(o(),h(A,{key:0},[$(" Hey, you've won! ")],64)):(o(),h(A,{key:1},[$(" You've lost, but you can try again! ")],64))]),body:y(()=>[l("div",qe,[l("div",Xe," The game ended in "+w(C(e).tour.number)+" rounds. ",1),m(Ae,{class:"end-game__link",to:{name:"choose-cards"}},{default:y(()=>[$(" Let's rock. ")]),_:1})])]),_:1},8,["is-open"]))}});const Re=H(Ke,[["__scopeId","data-v-8ce6dc01"]]),Ye=["src"],Je={class:"action-icon__count"},Qe=T({__name:"ActionIcon",props:{action:{}},setup(a){const e=a,t=E(()=>e.action.actions.filter(s=>!s.isActivated).length);return(s,r)=>(o(),h("div",{class:B(["action-icon",{"action-icon--disabled":t.value===0}])},[l("img",{class:"action-icon__image",src:s.action.image},null,8,Ye),l("span",Je,w(t.value),1)],2))}});const Ze=H(Qe,[["__scopeId","data-v-6f048c25"]]),et={key:0,class:"player-actions-panel"},tt=T({__name:"ThePlayerActionsPanel",props:ve({selectedCardFighter:{}},{selectedAction:{required:!0}}),emits:["update:selectedAction"],setup(a){const e=fe(a,"selectedAction"),t=s=>{if(e.value===s){e.value=void 0;return}e.value=s};return(s,r)=>(o(),P(J,{name:"player-actions-panel"},{default:y(()=>[s.selectedCardFighter?(o(),h("div",et,[(o(!0),h(A,null,F(s.selectedCardFighter.actions,(i,n)=>(o(),P(Ze,{key:n,action:i,class:B(["player-actions-panel__item",{"player-actions-panel__item--active":i===e.value}]),onClick:c=>t(i)},null,8,["action","class","onClick"]))),128))])):X("",!0)]),_:1}))}});const at=H(tt,[["__scopeId","data-v-fe82a877"]]),st={class:"tour-information"},nt={class:"tour-information__number"},rt={class:"tour-information__timer"},it=T({__name:"TheTourInformation",setup(a){const{tour:e}=pe(O());return(t,s)=>(o(),P(K,{to:"body"},[l("div",st,[l("div",nt," Round: "+w(C(e).number),1),l("div",rt," Time left: "+w(C(e).minutes)+":"+w(C(e).seconds),1)])]))}});const ot=H(it,[["__scopeId","data-v-34014c18"]]),ct={class:"fight-field"},lt={class:"fight-field__graveyard"},dt={class:"fight-field__arena"},ut={class:"fight-field__player"},_t={class:"fight-field__enemy"},ht=T({__name:"TheFightField",setup(a){const e=me(),t=O(),s=k({width:"0px",height:"0px"}),r=k([]),i=k([]),n=k(),c=k(),v=E(()=>r.value.filter(d=>d.isAlive)),p=E(()=>i.value.filter(d=>d.isAlive)),f=E(()=>v.value.length===0||p.value.length===0),ne=new $e({healPower:3,leftHp:1.25,attackPower:1,playerCards:r.value,botCards:i.value}),re=()=>{e.cardsRaw.forEach(d=>{r.value.push(D(d))}),Ee().forEach(d=>{i.value.push(D(d))}),ge(()=>{const d=document.querySelector(".card-fighter:first-child");if(d){const{clientHeight:b,clientWidth:u}=d;s.value.height=`${u}px`,s.value.width=`${b}px`}t.startGame()})},ie=()=>{t.endGame()},G=(d,b)=>{if(t.isPlayer){if(c.value){const u=c.value.actions.find(M=>!M.isActivated);u?u.activate(d):c.value=void 0,be(v.value)<=0&&(n.value=void 0,t.endTour(),t.startNewTour())}if(n.value===d&&b){n.value=void 0,c.value=void 0;return}if(b){n.value=d,c.value=void 0;return}}},L=()=>{f.value&&t.endGame()};return R(re),Y(ie),x(()=>t.isPlayer,async()=>{t.isPlayer?z(r.value):(z(i.value),await ne.makeActions(),t.startNewTour())}),x(()=>v.value.length,L),x(()=>p.value.length,L),(d,b)=>(o(),h("div",ct,[m(ot),l("div",lt,[m(q,{class:"fight-field__graveyard-player","is-player":!0,"cards-fighters":r.value,"card-size":s.value},null,8,["cards-fighters","card-size"]),m(q,{class:"fight-field__graveyard-enemy","is-player":!1,"cards-fighters":i.value,"card-size":s.value},null,8,["cards-fighters","card-size"])]),l("div",dt,[l("div",ut,[m(W,{name:"fight-field__list"},{default:y(()=>[(o(!0),h(A,null,F(v.value,u=>(o(),P(S,{key:u.name,fighter:u,"is-player":!0,"is-selected":u===n.value,onClick:M=>G(u,!0)},null,8,["fighter","is-selected","onClick"]))),128))]),_:1})]),l("div",_t,[m(W,{name:"fight-field__list"},{default:y(()=>[(o(!0),h(A,null,F(p.value,u=>(o(),P(S,{key:u.name,fighter:u,"is-player":!1,onClick:M=>G(u,!1)},null,8,["fighter","onClick"]))),128))]),_:1})]),m(at,{"selected-action":c.value,"onUpdate:selectedAction":b[0]||(b[0]=u=>c.value=u),"selected-card-fighter":n.value},null,8,["selected-action","selected-card-fighter"])]),m(Re,{"game-end":f.value,"is-win":v.value>p.value},null,8,["game-end","is-win"])]))}});const gt=H(ht,[["__scopeId","data-v-9d920c46"]]);export{gt as default};
